(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1903"],{"++rH":function(e,t,a){"use strict";a.d(t,"c",function(){return r}),a.d(t,"a",function(){return l}),a.d(t,"e",function(){return n}),a.d(t,"b",function(){return o}),a.d(t,"d",function(){return c}),a.d(t,"f",function(){return u});var i=a("t3Un"),s=a("d+CK");function r(e){return Object(i.a)({url:"/u/npcList",method:"post",proxy:s.a,data:e})}function l(e){return Object(i.a)({url:"/u/saveOrUpdate",method:"post",proxy:s.a,data:e})}function n(e){return Object(i.a)({url:"/u/saveOrUpdate",method:"post",proxy:s.a,data:e})}function o(e){return Object(i.a)({url:"/u/delete",method:"post",proxy:s.a,data:e})}function c(e){return Object(i.a)({url:"/u/followNpc/list",method:"post",proxy:s.a,data:e})}function u(e){return Object(i.a)({url:"/u/followNpc",method:"post",proxy:s.a,data:e})}},"2QOn":function(e,t,a){},"2YEQ":function(e,t,a){},"9Pcu":function(e,t,a){"use strict";var i={props:{thead:{type:Array,required:!0},list:{type:Array,required:!0,default:function(){return[]}},actions:{type:Array,default:function(){return[]}},listLoading:{type:Boolean,default:!1}},computed:{},created:function(){},methods:{}},s=(a("SG8p"),a("KHd+")),r=Object(s.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{"border-radius":"6px","margin-top":"15px"},attrs:{data:e.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[e._l(e.thead,function(t){return a("el-table-column",{key:t.label,attrs:{sortable:t.sort,label:t.label,width:t.width,prop:t.value,align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t.isImage?["Array"==={}.toString.call(i.row[t.value]).slice(8,-1)?a("el-carousel",{attrs:{height:t.styleObject.height,autoplay:!1,"indicator-position":"none",type:"card"}},e._l(i.row[t.value],function(e,i){return a("el-carousel-item",{key:i},[a("img",{style:t.styleObject,attrs:{src:e,alt:"暂无图片"}})])})):a("img",{style:t.styleObject,attrs:{src:i.row[t.value],alt:"暂无图片"}})]:t.isTag?e._l(i.row[t.value],function(t,i){return a("span",{key:i,staticClass:"el-tag el-tag--info el-tag--small",staticStyle:{margin:"4px"}},[a("span",{staticClass:"el-select__tags-text"},[e._v("\n            "+e._s(t)+"\n          ")])])}):[e._v("\n        "+e._s(i.row[t.value])+"\n      ")]]}}])})}),e._v(" "),0!==e.list.length&&0!==e.actions.length?a("el-table-column",{attrs:{label:"操作",align:"center",width:"160","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.actions,function(i,s){return a("el-button",{key:i.value,style:{margin:e.actions.length>2?"5px":"0 0 0 10px"},attrs:{type:i.type,size:"mini"},on:{click:function(e){i.click(t.row,t.$index)}}},[e._v(e._s(i.value)+"\n      ")])})}}])}):e._e()],2)},[],!1,null,"5215e21c",null);r.options.__file="index.vue";t.a=r.exports},"9TPh":function(e,t,a){"use strict";var i=a("QbLZ"),s=a.n(i),r=a("vDqi"),l=a.n(r),n=(a("EVdn"),a("XJYT")),o=(a("X4fA"),a("L2JU")),c={props:{number:{type:Number,required:!0},imgNum:{type:Number,default:1},imgWidth:{type:Number,default:160},imgHeight:{type:Number,default:100},imgs:{type:[Array,String]},imageSrc:{type:String}},model:{prop:"imgs",event:"cc"},data:function(){return{type:1}},computed:{imageAry:function(){return void 0===this.imageSrc?"Array"==={}.toString.call(this.imgs).slice(8,-1)?(this.type=2,this.imgs):(this.type=1,[this.imgs]):(this.type=3,this.imgs)}},methods:s()({},Object(o.b)(["token"]),{fileChange:function(e,t){var a=this,i=e.target.files[0];if(console.log(i.type),i&&-1!==["image/jpeg","image/png","image/gif","video/mp3","video/mp4"].indexOf(i.type)){var s={target:"#upload"+this.number+t,background:"white",customClass:"imgMask"},r=n.Loading.service(s),o=new FormData;o.append("file",i);var c={headers:{token:this.token()}};l.a.post("https://luna.ajimiyou.com/luna/image/upload",o,c).then(function(e){console.log("响应结果",e.data);var i=e.data.data,s=i;2===a.type&&(a.imgs[t]=i,s=a.imgs.filter(function(e){return null!=e})),a.$emit("cc",s),r.close()}).catch(function(e){console.log("错误结果",e),a.$message({message:"出错了！*>﹏<* ~ 请重新上传",type:"error",duration:1800}),r.close()})}else this.$message({message:"仅支持jpeg,png,gif,mp3,mp4格式的文件",type:"error",duration:1800})},handleDelete:function(e){console.log("删除的图片",e);var t="";2===this.type&&(this.imgs[e]=null,t=this.imgs.filter(function(e){return null!=e})),this.$emit("cc",t)}})},u=(a("iZ8v"),a("KHd+")),p=Object(u.a)(c,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"imageLoad clearfix"},e._l(e.imgNum,function(t,i){return a("div",{key:i,staticClass:"load-inner",style:{width:e.imgWidth+"px",height:e.imgHeight+"px"}},[1===e.type||2===e.type?[null==e.imageAry[i]||""==e.imageAry[i]?[a("div",{style:{height:e.imgHeight+"px"},attrs:{id:"upload"+e.number+i}},[a("i",{staticClass:"load-icon el-icon-plus"}),e._v(" "),a("input",{staticClass:"load-file",attrs:{type:"file",name:"image"},on:{change:function(t){e.fileChange(t,i)}}})])]:[a("div",{staticClass:"load-img"},[a("label",{staticClass:"delete-label"},[a("i",{staticClass:"delete el-icon-close",on:{click:function(t){e.handleDelete(i)}}})]),e._v(" "),a("img",{attrs:{src:e.imageAry[i],alt:"暂无图片"}})])]]:e._e()],2)}))},[],!1,null,"01b5e87c",null);p.options.__file="index.vue";t.a=p.exports},SG8p:function(e,t,a){"use strict";var i=a("TqJv");a.n(i).a},TqJv:function(e,t,a){},"d+CK":function(e,t,a){"use strict";t.a={host:"http://180.76.105.42:8101/admin"}},iZ8v:function(e,t,a){"use strict";var i=a("2QOn");a.n(i).a},jRE9:function(e,t,a){"use strict";var i=a("2YEQ");a.n(i).a},"r+UQ":function(e,t,a){"use strict";a.r(t);var i=a("FyfS"),s=a.n(i),r=a("P2sY"),l=a.n(r),n=a("9Pcu"),o=a("9TPh"),c=a("++rH"),u={components:{Table:n.a,Dropzone:o.a},data:function(){return{list:[],listLoading:!0,total:0,thead:[],listQuery:{index:1,pageSize:10,orderType:1},temp:{nickname:"",avatar:"",cover:"",successCard:"",signature:"",sex:0,country:"中国",type:1,sequence:0,virtualType:0,des:""},shipTemp:{userId:"",followIds:[]},dialogStatus:"",dialogFormVisible:!1,rules:{nickname:[{type:"string",required:!0,message:"名字是必须的",trigger:"blur"}],country:[{type:"string",required:!0,message:"国家是必须的",trigger:"blur"}],signature:[{type:"string",required:!0,message:"个性签名是必须的",trigger:"blur"}],sex:[{type:"number",required:!0,message:"性别是必须的",trigger:"blur"}],virtualType:[{type:"number",required:!0,message:"人物形象是必须的",trigger:"blur"}],sequence:[{type:"number",required:!0,message:"剧本选择是必须的",trigger:"blur"}],userId:[{type:"number",required:!0,message:"人物是必须的",trigger:"blur"}],followIds:[{type:"array",required:!0,message:"请选择要关注的好友",trigger:"change"}]},actions:[{type:"primary",value:"编辑",click:this.handleUpdate},{type:"danger",value:"删除",click:this.handleDelete}]}},created:function(){this.fetchData()},computed:{filterList:function(){var e=this;return this.list.filter(function(t){return t.id!==e.shipTemp.userId})}},methods:{dataFilter:function(e){return"Array"==={}.toString.call(e).slice(8,-1)?e.forEach(function(e){e.zh_type=0===e.virtualType?"好人":"坏人"}):e.zh_type=0===e.virtualType?"好人":"坏人",e},fetchData:function(){var e=this;Object(c.c)(this.listQuery).then(function(t){console.log(t);var a=t.data,i=e.dataFilter(a);e.getHead(i),e.list=i,e.listLoading=!1})},fetchNpcFocus:function(){var e=this;console.log(this.shipTemp);var t=this.shipTemp.userId;Object(c.d)({id:t}).then(function(a){var i=[];a.data.forEach(function(e){e.id!==t&&i.push(e.id)}),e.shipTemp.followIds=i})},getHead:function(e){var t=[];for(var a in e[0]){var i={sort:!1};switch(a){case"nickname":i.label="名称",i.width="100",i.value=a,t[0]=i;break;case"avatar":i.label="头像",i.value=a,i.isImage=!0,i.styleObject={width:"100px",height:"100px"},t[1]=i;break;case"signature":i.label="个性签名",i.value=a,t[2]=i;break;case"des":i.label="人物描述",i.value=a,t[3]=i;break;case"zh_type":i.label="人物形象",i.width="60",i.value=a,t[4]=i;break;case"cover":i.label="封面",i.value=a,i.isImage=!0,i.styleObject={width:"200px",height:"150px"},t[5]=i;break;default:continue}}this.thead=t},handleCurrentChange:function(e){this.listQuery.index=e,this.fetchData()},handleFilter:function(){this.listQuery.index=1,this.fetchData()},handleCreate:function(){var e=this;this.resetTemp(),this.dialogStatus="添加",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate()})},handleShip:function(){var e=this;this.shipTemp={userId:"",followIds:[]},this.dialogStatus="添加好友关系",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.shipForm.clearValidate()})},handleUpdate:function(e){var t=this;this.temp=l()(e.successCard?{successCard:""}:{},e),this.dialogStatus="编辑",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},handleDelete:function(e){var t=this;console.log("要删除的id",e.id),Object(c.b)({id:e.id}).then(function(){var a=t.list.indexOf(e);t.list.splice(a,1),t.$notify({title:"成功",message:"用户删除成功",type:"success",duration:1500})})},resetTemp:function(){this.temp={nickname:"",avatar:"",cover:"",successCard:"",signature:"",sex:0,country:"中国",type:1,sequence:0,virtualType:0,des:""}},createData:function(){var e=this;this.$refs.dataForm.validate(function(t){if(t){if(""===e.temp.avatar)return void e.$message({message:"头像是必须的",type:"error",duration:1500});var a=l()({},e.temp);console.log("createData",a),Object(c.a)(a).then(function(){var t=e.dataFilter(a);e.list.unshift(t),e.dialogFormVisible=!1,e.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})})}})},createShip:function(){var e=this;this.$refs.shipForm.validate(function(t){if(t){var a=l()({},e.shipTemp);console.log("createShip",a),Object(c.f)(a).then(function(){e.dialogFormVisible=!1,e.$notify({title:"成功",message:"关注成功",type:"success",duration:2e3})})}})},updateData:function(){var e=this;this.$refs.dataForm.validate(function(t){if(t){if(""===e.temp.avatar)return void e.$message({message:"头像是必须的",type:"error",duration:1500});var a=e.temp,i={id:a.id,nickname:a.nickname,country:a.country,sex:a.sex,virtualType:a.virtualType,sequence:a.sequence,signature:a.signature,des:a.des,avatar:a.avatar,cover:a.cover,successCard:a.successCard};console.log("updateData",i),Object(c.e)(i).then(function(){var t=e.dataFilter(i),a=!0,r=!1,l=void 0;try{for(var n,o=s()(e.list);!(a=(n=o.next()).done);a=!0){var c=n.value;if(c.id===t.id){var u=e.list.indexOf(c);e.list.splice(u,1,t);break}}}catch(e){r=!0,l=e}finally{try{!a&&o.return&&o.return()}finally{if(r)throw l}}e.dialogFormVisible=!1,e.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})})}})}}},p=(a("jRE9"),a("KHd+")),d=Object(p.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"inner"},[a("span",{staticClass:"title"},[e._v("NPC管理")]),e._v(" "),a("div",{staticClass:"app-container"},[a("el-button",{staticClass:"filter-item",attrs:{type:"success",icon:"el-icon-edit"},on:{click:e.handleCreate}},[e._v("添加NPC")]),e._v(" "),a("el-button",{staticClass:"filter-item",attrs:{type:"success",icon:"el-icon-edit"},on:{click:e.handleShip}},[e._v("添加好友关系")]),e._v(" "),a("Table",{attrs:{thead:e.thead,list:e.list||[],listLoading:e.listLoading,actions:e.actions}}),e._v(" "),a("div",{staticClass:"pagination-container",staticStyle:{"margin-top":"20px"},attrs:{align:"right"}},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next, jumper",total:e.total,"current-page":e.listQuery.index,"page-size":e.listQuery.pageSize},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogStatus,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"dialog"},["添加好友关系"===e.dialogStatus?[a("div",{staticClass:"ship"},[a("el-form",{ref:"shipForm",staticStyle:{"min-width":"450px","max-width":"1000px"},attrs:{rules:e.rules,model:e.shipTemp,"label-position":"right","label-width":"110px"}},[a("el-form-item",{attrs:{label:"人物",prop:"userId"}},[a("el-select",{attrs:{placeholder:"请选择人物"},on:{change:e.fetchNpcFocus},model:{value:e.shipTemp.userId,callback:function(t){e.$set(e.shipTemp,"userId",t)},expression:"shipTemp.userId"}},e._l(e.list,function(e,t){return a("el-option",{key:t,attrs:{label:e.nickname,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"关注的好友",prop:"followIds"}},[a("el-select",{staticStyle:{width:"400px"},attrs:{multiple:"",placeholder:"请选择关注的好友"},model:{value:e.shipTemp.followIds,callback:function(t){e.$set(e.shipTemp,"followIds",t)},expression:"shipTemp.followIds"}},e._l(e.filterList,function(e){return a("el-option",{key:e.id,attrs:{label:e.nickname,value:e.id}})}))],1)],1)],1)]:[a("el-form",{ref:"dataForm",staticStyle:{"min-width":"450px","max-width":"1000px"},attrs:{rules:e.rules,model:e.temp,"label-position":"right","label-width":"110px"}},[a("div",{staticClass:"form-left"},[a("el-form-item",{staticClass:"nickname",attrs:{label:"名称",prop:"nickname"}},[a("el-input",{model:{value:e.temp.nickname,callback:function(t){e.$set(e.temp,"nickname","string"==typeof t?t.trim():t)},expression:"temp.nickname"}})],1),e._v(" "),a("el-form-item",{staticClass:"country",attrs:{label:"国家",prop:"country"}},[a("el-input",{model:{value:e.temp.country,callback:function(t){e.$set(e.temp,"country","string"==typeof t?t.trim():t)},expression:"temp.country"}})],1),e._v(" "),a("el-form-item",{staticClass:"virtualType",attrs:{label:"人物形象",prop:"virtualType"}},[a("el-select",{attrs:{placeholder:"请选择人物形象"},model:{value:e.temp.virtualType,callback:function(t){e.$set(e.temp,"virtualType",t)},expression:"temp.virtualType"}},[a("el-option",{attrs:{label:"好人",value:0}}),e._v(" "),a("el-option",{attrs:{label:"坏人",value:1}})],1)],1),e._v(" "),a("el-form-item",{staticClass:"sequence",attrs:{label:"剧本",prop:"sequence"}},[a("el-select",{attrs:{placeholder:"请选择是否有剧本"},model:{value:e.temp.sequence,callback:function(t){e.$set(e.temp,"sequence",t)},expression:"temp.sequence"}},[a("el-option",{attrs:{label:"无剧本",value:0}}),e._v(" "),a("el-option",{attrs:{label:"有剧本",value:1}})],1)],1),e._v(" "),a("el-form-item",{staticClass:"signature",attrs:{label:"个性签名",prop:"signature"}},[a("el-input",{attrs:{autosize:{minRows:3,maxRows:5},type:"textarea",placeholder:"请输入个性签名"},model:{value:e.temp.signature,callback:function(t){e.$set(e.temp,"signature","string"==typeof t?t.trim():t)},expression:"temp.signature"}})],1),e._v(" "),a("el-form-item",{staticClass:"des",attrs:{label:"人物描述"}},[a("el-input",{attrs:{autosize:{minRows:5,maxRows:6},type:"textarea",placeholder:"请输入个性签名"},model:{value:e.temp.des,callback:function(t){e.$set(e.temp,"des","string"==typeof t?t.trim():t)},expression:"temp.des"}})],1),e._v(" "),a("el-form-item",{staticClass:"avatar",attrs:{label:"头像"}},[a("Dropzone",{attrs:{number:0,imgWidth:150,imgHeight:150},model:{value:e.temp.avatar,callback:function(t){e.$set(e.temp,"avatar",t)},expression:"temp.avatar"}})],1),e._v(" "),a("el-form-item",{staticClass:"cover",attrs:{label:"封面","label-width":"90px"}},[a("Dropzone",{attrs:{number:1,imgWidth:150,imgHeight:150},model:{value:e.temp.cover,callback:function(t){e.$set(e.temp,"cover",t)},expression:"temp.cover"}})],1)],1),e._v(" "),a("div",{staticClass:"form-right"},[a("el-form-item",{staticClass:"successCard",attrs:{label:"解锁成功","label-width":"68px"}},[a("Dropzone",{attrs:{number:2,imgWidth:320,imgHeight:500},model:{value:e.temp.successCard,callback:function(t){e.$set(e.temp,"successCard",t)},expression:"temp.successCard"}})],1)],1)])],e._v(" "),a("div",{staticClass:"dialog-footer clearfix",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{float:"left"},attrs:{type:"primary"},on:{click:function(t){e.dialogFormVisible=!e.dialogFormVisible}}},[e._v("取消")]),e._v(" "),"添加好友关系"===e.dialogStatus?[a("el-button",{staticStyle:{float:"right"},attrs:{type:"success"},on:{click:function(t){e.createShip()}}},[e._v("保存")])]:[a("el-button",{staticStyle:{float:"right"},attrs:{type:"success"},on:{click:function(t){"编辑"===e.dialogStatus?e.updateData():e.createData()}}},[e._v(e._s("编辑"==e.dialogStatus?"保存":"添加"))])]],2)],2)])],1)])},[],!1,null,"5bd131a4",null);d.options.__file="index.vue";t.default=d.exports}}]);