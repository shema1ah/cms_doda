(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7531"],{"++rH":function(t,e,a){"use strict";a.d(e,"c",function(){return s}),a.d(e,"a",function(){return o}),a.d(e,"e",function(){return r}),a.d(e,"b",function(){return l}),a.d(e,"d",function(){return c}),a.d(e,"f",function(){return u});var i=a("t3Un"),n=a("d+CK");function s(t){return Object(i.a)({url:"/u/npcList",method:"post",proxy:n.a,data:t})}function o(t){return Object(i.a)({url:"/u/saveOrUpdate",method:"post",proxy:n.a,data:t})}function r(t){return Object(i.a)({url:"/u/saveOrUpdate",method:"post",proxy:n.a,data:t})}function l(t){return Object(i.a)({url:"/u/delete",method:"post",proxy:n.a,data:t})}function c(t){return Object(i.a)({url:"/u/followNpc/list",method:"post",proxy:n.a,data:t})}function u(t){return Object(i.a)({url:"/u/followNpc",method:"post",proxy:n.a,data:t})}},"9Pcu":function(t,e,a){"use strict";var i={props:{thead:{type:Array,required:!0},list:{type:Array,required:!0,default:function(){return[]}},actions:{type:Array,default:function(){return[]}},listLoading:{type:Boolean,default:!1}},computed:{},created:function(){},methods:{}},n=(a("SG8p"),a("KHd+")),s=Object(n.a)(i,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{"border-radius":"6px","margin-top":"15px"},attrs:{data:t.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[t._l(t.thead,function(e){return a("el-table-column",{key:e.label,attrs:{sortable:e.sort,label:e.label,width:e.width,prop:e.value,align:"center"},scopedSlots:t._u([{key:"default",fn:function(i){return[e.isImage?["Array"==={}.toString.call(i.row[e.value]).slice(8,-1)?a("el-carousel",{attrs:{height:e.styleObject.height,autoplay:!1,"indicator-position":"none",type:"card"}},t._l(i.row[e.value],function(t,i){return a("el-carousel-item",{key:i},[a("img",{style:e.styleObject,attrs:{src:t,alt:"暂无图片"}})])})):a("img",{style:e.styleObject,attrs:{src:i.row[e.value],alt:"暂无图片"}})]:e.isTag?t._l(i.row[e.value],function(e,i){return a("span",{key:i,staticClass:"el-tag el-tag--info el-tag--small",staticStyle:{margin:"4px"}},[a("span",{staticClass:"el-select__tags-text"},[t._v("\n            "+t._s(e)+"\n          ")])])}):[t._v("\n        "+t._s(i.row[e.value])+"\n      ")]]}}])})}),t._v(" "),0!==t.list.length&&0!==t.actions.length?a("el-table-column",{attrs:{label:"操作",align:"center",width:"160","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.actions,function(i,n){return a("el-button",{key:i.value,style:{margin:t.actions.length>2?"5px":"0 0 0 10px"},attrs:{type:i.type,size:"mini"},on:{click:function(t){i.click(e.row,e.$index)}}},[t._v(t._s(i.value)+"\n      ")])})}}])}):t._e()],2)},[],!1,null,"5215e21c",null);s.options.__file="index.vue";e.a=s.exports},FyfS:function(t,e,a){t.exports={default:a("Rp86"),__esModule:!0}},"PE/C":function(t,e,a){"use strict";a.r(e);var i=a("m1cH"),n=a.n(i),s=a("FyfS"),o=a.n(s),r=a("P2sY"),l=a.n(r),c=a("QbLZ"),u=a.n(c),d=a("9Pcu"),m=a("L2JU"),f=a("++rH"),p=a("jRfo"),h={components:{Table:d.a},data:function(){return{headers:{},name:"",avatar:"",npcList:[],list:[],listLoading:!0,total:0,thead:[],listQuery:{userId:"",index:1,pageSize:10,orderType:1},temp:{user:null,content:"",type:0},dialogStatus:"",dialogFormVisible:!1,dialogImageUrl:"",dialogVisible:!1,images:[],rules:{content:[{type:"string",required:!0,message:"内容是必须的",trigger:"blur"}],userIds:[{type:"array",required:!0,message:"请选择点赞的人",trigger:"change"}],userId:[{type:"number",required:!0,message:"请选择评论的人",trigger:"change"}]},actions:[{type:"primary",value:"点赞",click:this.handleFavour},{type:"primary",value:"评论",click:this.handleComment}]}},created:function(){this.getUserId(),this.fetchData(),this.fetchNpcData()},methods:u()({},Object(m.b)(["token"]),{getUserId:function(){var t=this.$route.query,e=t.userId,a=t.name,i=t.avatar;this.listQuery.userId=parseInt(e),this.name=a,this.avatar=i,this.headers={token:this.token()},this.temp.user={id:e}},dataFilter:function(t){var e=this;if("Array"==={}.toString.call(t).slice(8,-1))t.forEach(function(t){var a=[],i=[],n=[];t.images&&t.images.forEach(function(t){a.push(t.imageUrl)}),t.commentList&&t.commentList.forEach(function(t){i.push(t.userName+"："+t.content)}),t.favorList&&t.favorList.forEach(function(t){n.push(t.nickname)}),t.zy_avatar=e.avatar,t.zy_imgs=a,t.zy_comments=i,t.zy_favors=n});else{console.log(t);var a=[];if(t.images&&t.images.forEach(function(t){a.push(t.imageUrl)}),2===t.type){var i=this.npcList.filter(function(e){return t.userIds.indexOf(e.id)>-1}),n=[];i.forEach(function(t){n.push(t.nickname)}),t.zy_favors=n,t.favorList=i}if(3===t.type){var s=this.npcList.find(function(e){return e.id===t.userId});t.zy_comments=[s.nickname+"："+t.content]}t.zy_avatar=this.avatar,t.zy_imgs=a}return t},fetchNpcData:function(){var t=this;Object(f.c)(this.listQuery).then(function(e){console.log("所有NPC列表",e);var a=[];e.data.forEach(function(e,i){if(e.id!==t.listQuery.userId){var n={};n.id=e.id,n.nickname=e.nickname,a.push(n)}}),t.npcList=a})},fetchData:function(){var t=this;Object(p.a)(this.listQuery).then(function(e){console.log("当前NPC的朋友圈",e);var a=e.data,i=a.items,n=a.totalCount,s=t.dataFilter(i);t.getHead(s),t.list=s,t.total=parseInt(n),t.listLoading=!1})},getHead:function(t){var e=[];for(var a in t[0]){var i={sort:!1};switch(a){case"zy_avatar":i.label="头像",i.value=a,i.width="100",i.isImage=!0,i.styleObject={width:"80px",height:"80px"},e[0]=i;break;case"content":i.label="发布的文字",i.value=a,i.width="250",e[1]=i;break;case"zy_imgs":i.label="发布的图片",i.value=a,i.isImage=!0,i.width="198",i.styleObject={width:"80px",height:"80px",margin:"4px"},e[2]=i;break;case"zy_favors":i.label="点赞的人",i.value=a,i.isTag=!0,i.width="300",e[3]=i;break;case"zy_comments":i.label="评论",i.value=a,i.isTag=!0,e[4]=i}}this.thead=e},handleCurrentChange:function(t){this.listQuery.index=t,this.fetchData()},handleFilter:function(){this.listQuery.index=1,this.fetchData()},uploadImgFilter:function(t){var e=[];t.forEach(function(t,a){var i={};i.imageUrl=t.response.data,i.sequence=a+1,e.push(i)}),this.images=e},handleImgSuccess:function(t,e,a){console.log(t,e,a),this.uploadImgFilter(a)},handleImgError:function(t){console.log("上传图片失败",t),this.$message({type:"error",message:"上传图片失败",duration:1500})},handleImgCb:function(t){console.log("查看图片成功",t),this.dialogImageUrl=t.url,this.dialogVisible=!0},handleImgRemove:function(t,e){console.log("移除上传图片成功",e),this.uploadImgFilter(e)},handleImgLimit:function(){this.$message({message:"最多上传6张图片",type:"error",duration:1800})},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus="发朋友圈",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},upLoadImgCancel:function(){this.dialogFormVisible=!this.dialogFormVisible,this.$refs.myUpload&&this.$refs.myUpload.clearFiles()},handleFavour:function(t){var e=this;console.log("点赞",t);var a=[];t.favorList&&0!==t.favorList.length&&t.favorList.forEach(function(t){a.push(t.id)}),this.temp=l()({},{momentId:t.id,userIds:a}),this.dialogStatus="点赞",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate()})},updateFavourSave:function(){var t=this;this.$refs.dataForm.validate(function(e){if(e){var a=l()({},t.temp);console.log("点赞保存",a),Object(p.c)(a).then(function(e){a.type=2;var i=t.dataFilter(a),n=!0,s=!1,r=void 0;try{for(var l,c=o()(t.list);!(n=(l=c.next()).done);n=!0){var u=l.value;if(u.id===i.momentId){u.zy_favors=i.zy_favors,u.favorList=i.favorList;break}}}catch(t){s=!0,r=t}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}t.dialogFormVisible=!1,t.$notify({title:"成功",message:"点赞成功",type:"success",duration:1500})})}})},handleComment:function(t){var e=this;console.log("评论",t),this.temp=l()({},{momentId:t.id,userId:"",content:""}),this.dialogStatus="评论",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate()})},updateCommentSave:function(){var t=this;this.$refs.dataForm.validate(function(e){if(e){var a=l()({},t.temp);console.log("评论保存",a),Object(p.b)(a).then(function(){a.type=3;var e=t.dataFilter(a),i=!0,s=!1,r=void 0;try{for(var l,c=o()(t.list);!(i=(l=c.next()).done);i=!0){var u=l.value;if(u.id===e.momentId){u.zy_comments?u.zy_comments=[].concat(n()(u.zy_comments),n()(e.zy_comments)):u.zy_comments=e.zy_comments;break}}}catch(t){s=!0,r=t}finally{try{!i&&c.return&&c.return()}finally{if(s)throw r}}t.dialogFormVisible=!1,t.$notify({title:"成功",message:"评论成功",type:"success",duration:1500})})}})},resetTemp:function(){this.images=[],this.temp={user:{id:this.listQuery.userId},content:"",type:0}},createData:function(){var t=this;this.$refs.dataForm.validate(function(e){if(e){var a=l()({},t.temp);0!==t.images.length&&(a.images=t.images,a.type=1),console.log("createData",a),Object(p.d)(a).then(function(e){console.log(e);var i=t.dataFilter(a);t.list.unshift(i),t.dialogFormVisible=!1,t.$notify({title:"成功",message:"创建成功",type:"success",duration:1500})})}})}})},g=(a("RlF4"),a("KHd+")),v=Object(g.a)(h,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"inner"},[a("span",{staticClass:"title"},[t._v(t._s(t.name)+" 的朋友圈")]),t._v(" "),a("div",{staticClass:"app-container"},[a("el-button",{staticClass:"filter-item",attrs:{type:"success",icon:"el-icon-edit"},on:{click:t.handleCreate}},[t._v("发朋友圈")]),t._v(" "),a("Table",{attrs:{thead:t.thead,list:t.list||[],listLoading:t.listLoading,actions:t.actions}}),t._v(" "),a("div",{staticClass:"pagination-container",staticStyle:{"margin-top":"20px"},attrs:{align:"right"}},[a("el-pagination",{attrs:{total:t.total,"current-page":t.listQuery.index,"page-size":t.listQuery.pageSize,background:"",layout:"prev, pager, next, jumper"},on:{"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{attrs:{title:t.dialogStatus,visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("div",{staticClass:"dialog"},[a("el-form",{ref:"dataForm",staticStyle:{"min-width":"450px","max-width":"1000px"},attrs:{rules:t.rules,model:t.temp,"label-position":"right","label-width":"110px"}},["发朋友圈"===t.dialogStatus?[a("el-form-item",{staticClass:"content",attrs:{label:"内容",prop:"content"}},[a("el-input",{attrs:{autosize:{minRows:3,maxRows:4},type:"textarea",placeholder:"请输入内容"},model:{value:t.temp.content,callback:function(e){t.$set(t.temp,"content","string"==typeof e?e.trim():e)},expression:"temp.content"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"图片"}},[a("el-upload",{ref:"myUpload",attrs:{action:"https://luna.ajimiyou.com/luna/image/upload",headers:t.headers,"list-type":"picture-card",limit:6,"on-success":t.handleImgSuccess,"on-error":t.handleImgError,"on-preview":t.handleImgCb,"on-remove":t.handleImgRemove,"on-exceed":t.handleImgLimit}},[a("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:"暂无图片"}})])]:"点赞"===t.dialogStatus?[a("el-form-item",{attrs:{label:"点赞的人",prop:"userIds"}},[a("el-select",{staticStyle:{width:"500px"},attrs:{multiple:"",placeholder:"请选择点赞的人"},model:{value:t.temp.userIds,callback:function(e){t.$set(t.temp,"userIds",e)},expression:"temp.userIds"}},t._l(t.npcList,function(t){return a("el-option",{key:t.id,attrs:{label:t.nickname,value:t.id}})}))],1)]:[a("el-form-item",{attrs:{label:"评论的人",prop:"userId"}},[a("el-select",{staticStyle:{width:"500px"},attrs:{placeholder:"请选择评论的人"},model:{value:t.temp.userId,callback:function(e){t.$set(t.temp,"userId",e)},expression:"temp.userId"}},t._l(t.npcList,function(t){return a("el-option",{key:t.id,attrs:{label:t.nickname,value:t.id}})}))],1),t._v(" "),a("el-form-item",{staticClass:"content",attrs:{label:"内容",prop:"content"}},[a("el-input",{attrs:{autosize:{minRows:3,maxRows:4},type:"textarea",placeholder:"请输入内容"},model:{value:t.temp.content,callback:function(e){t.$set(t.temp,"content","string"==typeof e?e.trim():e)},expression:"temp.content"}})],1)]],2),t._v(" "),a("div",{staticClass:"dialog-footer clearfix",attrs:{slot:"footer"},slot:"footer"},["发朋友圈"===t.dialogStatus?[a("el-button",{staticStyle:{float:"left"},attrs:{type:"primary"},on:{click:t.upLoadImgCancel}},[t._v("取消")]),t._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{type:"success"},on:{click:t.createData}},[t._v("发朋友圈")])]:[a("el-button",{staticStyle:{float:"left"},attrs:{type:"primary"},on:{click:function(e){t.dialogFormVisible=!t.dialogFormVisible}}},[t._v("取消")]),t._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{type:"success"},on:{click:function(e){"点赞"==t.dialogStatus?t.updateFavourSave():t.updateCommentSave()}}},[t._v(t._s(t.dialogStatus)+"保存")])]],2)],1)])],1)])},[],!1,null,"5901dee8",null);v.options.__file="friend.vue";e.default=v.exports},RlF4:function(t,e,a){"use strict";var i=a("scfd");a.n(i).a},Rp86:function(t,e,a){a("bBy9"),a("FlQf"),t.exports=a("fXsU")},SG8p:function(t,e,a){"use strict";var i=a("TqJv");a.n(i).a},TqJv:function(t,e,a){},"d+CK":function(t,e,a){"use strict";e.a={host:"http://180.76.105.42:8101/admin"}},fXsU:function(t,e,a){var i=a("5K7Z"),n=a("fNZA");t.exports=a("WEpk").getIterator=function(t){var e=n(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return i(e.call(t))}},igbY:function(t,e,a){"use strict";e.a={host:"https://api.ajimiyou.com/yanxi/admin"}},jRfo:function(t,e,a){"use strict";a.d(e,"a",function(){return s}),a.d(e,"d",function(){return o}),a.d(e,"c",function(){return r}),a.d(e,"b",function(){return l});var i=a("t3Un"),n=a("igbY");function s(t){return Object(i.a)({url:"/moment/list",method:"post",proxy:n.a,data:t})}function o(t){return Object(i.a)({url:"/moment/add",method:"post",proxy:n.a,data:t})}function r(t){return Object(i.a)({url:"/moment/addMomentFavorList",method:"post",proxy:n.a,data:t})}function l(t){return Object(i.a)({url:"/moment/addMomentComment",method:"post",proxy:n.a,data:t})}},scfd:function(t,e,a){}}]);